# Victoria Porter
# 908517
# Dec. 16, 2022
# CPRG216-ITB
# Project: Classess, Individual
# Class #4: Patient

from typing import List

class Patient:
    def __init__(self, pid, name, disease, gender, age):
        self.pid = pid
        self.name = name
        self.disease = disease
        self.gender = gender
        self.age = age

    def __str__(self):
        return f"{self.pid}, {self.name}, {self.disease}, {self.gender}, {self.age}"

    def formatPatientInfo(self):
        p_info = f"{self.pid}_{self.name}_{self.disease}_{self.gender}_{self.age}"
        return p_info

    def readPatientsFile(self):
        with open("patients.txt", "r") as file:
            for line in file:
                print(line)
            file.close()

    def displayPatientInfo(self):
        print(f"ID: {self.pid}")
        print(f"Name: {self.name}")
        print(f"Disease: {self.disease}")
        print(f"Gender: {self.gender}")
        print(f"Age: {self.age}")

    def addPatientToFile(self):
        p_info = self.formatPatientInfo()
        with open("patients.txt", "a") as file:
            file.write("\n")
            file.write(p_info)
            file.close()

def editPatientInfo(pid):
    name = input("Enter new name: ")
    disease = input("Enter new disease: ")
    gender = input("Enter new gender: ")
    age = input("Enter new age: ")
    with open("patients.txt", "r") as file:
        data = file.readlines()
    for i in range(len(data)):
        if data[i].startswith(pid):
            patient = Patient(pid, name, disease, gender, age)
            data[i] = patient.formatPatientInfo() + "\n"
    with open("patients.txt", "w") as file:
        file.writelines(data)

def enterPatientInfo():
    pid = input("Enter Patient ID: ")
    name = input("Enter Patient name: ")
    disease = input("Enter Patient disease: ")
    gender = input("Enter Patient gender: ")
    age = input("Enter Patient age:")
    return pid, name, disease, gender, age

def displayPatientList(file):
    patients = []
    with open(file, "r") as f:
        for line in f:
            pid, name, disease, gender, age = line.strip().split("_")
            patients.append(Patient(pid, name, disease, gender, age))
        f.close()
    for p in patients:
        print(p)

def searchPatientById(pid):
    with open("patients.txt", "r") as file:
        for line in file:
            if line.startswith(pid):
                values = line.strip().split("_")
                pid = values[0].strip()
                name = values[1].strip()
                disease = values[2].strip()
                gender = values[3].strip()
                age = values[4].strip()
                file.close()
                return Patient(pid, name, disease, gender, age)
        file.close()

def writeListOfPatientsToFile(patients_list: List[Patient]):
    for patient in patients_list:
        patient.addPatientToFile()

def DisplayPatientsMenu():
    print("1 - Display patients list")
    print("2 - Search for patient by ID")
    print("3 - Add patient")
    print("4 - Edit patient info")
    print("5 - Back to the Main Menu")

    category = int(input())

    if category == 1:
        displayPatientList("patients.txt")
        DisplayPatientsMenu()

    elif category == 2:
        patient_id = input("Enter the patient ID: ")
        patient = searchPatientById(patient_id)
        if patient:
            patient.displayPatientInfo()
        else:
            print("No patient found with that ID.")
        DisplayPatientsMenu()

    elif category == 3:
        pid, name, disease, gender, age = enterPatientInfo()
        patient = Patient(pid, name, disease, gender, age)
        patient.addPatientToFile()
        DisplayPatientsMenu()

    elif category == 4:
        patient_id = input("Please enter the ID of the Patient that you want to edit their information: ")
        patient = searchPatientById(patient_id)
        if patient:
            editPatientInfo(patient_id)
        else:
            print("No patient found with that ID.")
        DisplayPatientsMenu()
    elif category == 5:
        return

DisplayPatientsMenu()  
